{
	"info": {
		"_postman_id": "vehicle-tax-api-collection",
		"name": "Vehicle Tax Payment API",
		"description": "Colección completa para probar la API de gestión de pagos de impuestos vehiculares",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Health Check",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/health",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"health"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "2. Authentication",
			"item": [
				{
					"name": "Registro de Usuario Ciudadano",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('userToken', response.token);",
									"    pm.environment.set('userId', response.user.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"testuser\",\n  \"email\": \"test@example.com\",\n  \"password\": \"TestPassword123!\",\n  \"fullName\": \"Usuario de Prueba\",\n  \"phoneNumber\": \"3001234567\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "Login Usuario",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('userToken', response.token);",
									"    pm.environment.set('userId', response.user.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "Login Admin (Seeded)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('adminToken', response.token);",
									"    pm.environment.set('adminId', response.user.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@vehicletax.gov.co\",\n  \"password\": \"AdminPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "3. Vehicle Management",
			"item": [
				{
					"name": "Crear Vehículo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('vehicleId', response.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"plate\": \"ABC123\",\n  \"brand\": \"Toyota\",\n  \"model\": \"Corolla\",\n  \"year\": 2020,\n  \"engine\": \"1800\",\n  \"fuelType\": \"GASOLINE\",\n  \"bodyType\": \"SEDAN\",\n  \"color\": \"Blanco\",\n  \"municipalityCode\": \"05001\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/vehicles",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles"
							]
						}
					},
					"response": []
				},
				{
					"name": "Listar Mis Vehículos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vehicles",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles"
							]
						}
					},
					"response": []
				},
				{
					"name": "Obtener Vehículo por ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vehicles/{{vehicleId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles",
								"{{vehicleId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Actualizar Vehículo",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"color\": \"Rojo\",\n  \"municipalityCode\": \"05001\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/vehicles/{{vehicleId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles",
								"{{vehicleId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "4. Vigencias (Deudas)",
			"item": [
				{
					"name": "Consultar Vigencias de Vehículo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.length > 0) {",
									"        pm.environment.set('vigenciaId', response[0].id);",
									"        pm.environment.set('vigenciaAmount', response[0].amount);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vigencias/vehicle/{{vehicleId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vigencias",
								"vehicle",
								"{{vehicleId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Consultar Vigencias Pendientes Usuario",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vigencias/pending",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vigencias",
								"pending"
							]
						}
					},
					"response": []
				},
				{
					"name": "Buscar Vigencias por Placa",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vigencias/search?plate=ABC123",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vigencias",
								"search"
							],
							"query": [
								{
									"key": "plate",
									"value": "ABC123"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "5. Payments",
			"item": [
				{
					"name": "Procesar Pago de Vigencia",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('paymentId', response.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"vigenciaId\": \"{{vigenciaId}}\",\n  \"paymentMethod\": \"CREDIT_CARD\",\n  \"paymentReference\": \"CC-12345678\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/payments/pay",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"payments",
								"pay"
							]
						}
					},
					"response": []
				},
				{
					"name": "Consultar Mis Pagos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/my-payments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"payments",
								"my-payments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Obtener Detalles de Pago",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/{{paymentId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"payments",
								"{{paymentId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "6. Admin Functions",
			"item": [
				{
					"name": "Listar Todos los Pagos (Admin)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{adminToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/admin/payments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"admin",
								"payments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Estadísticas de Pagos (Admin)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{adminToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/payments/admin/stats",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"payments",
								"admin",
								"stats"
							]
						}
					},
					"response": []
				},
				{
					"name": "Listar Todos los Vehículos (Admin)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{adminToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vehicles/admin/all",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles",
								"admin",
								"all"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "7. Special Routes",
			"item": [
				{
					"name": "GET /vehicles/:vehicleId/vigencias",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/vehicles/{{vehicleId}}/vigencias",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles",
								"{{vehicleId}}",
								"vigencias"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /vehicles/:vehicleId/vigencias/:vigenciaId/pay",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{userToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"paymentMethod\": \"DEBIT_CARD\",\n  \"paymentReference\": \"DC-87654321\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/vehicles/{{vehicleId}}/vigencias/{{vigenciaId}}/pay",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"vehicles",
								"{{vehicleId}}",
								"vigencias",
								"{{vigenciaId}}",
								"pay"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3001",
			"type": "string"
		}
	]
}